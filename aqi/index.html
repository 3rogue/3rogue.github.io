<!DOCTYPE HTML><html><head><meta charset="utf-8"><title>AQI 超标提醒 | Yeoman</title><meta name="author" content="Yeoman"><meta name="description" content="python web acg"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:title" content="AQI 超标提醒"><meta property="og:site_name" content="Yeoman"><meta property="og:image" content="undefined"><link href="/favicon.ico" rel="icon" type="image/x-ico"><link rel="alternate" href="/atom.xml" title="Yeoman" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"><link rel="stylesheet" href="/google-code-prettify/prettify.css" type="text/css"><!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--></head></html><body><header id="banner"><div id="header" class="inner"><div id="head-content"><div class="blur1"></div><div class="alignleft"><h1><a href="/">Yeoman</a></h1><h2><a href="/">心有猛虎，细嗅蔷薇。</a></h2></div></div><div id="head-nav"><div class="blur2"></div><div id="main-nav"><ul><li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li><li><a href="/atom.xml">RSS</a></li><li><a href="/about">About</a></li></ul><div class="clearfix"></div></div></div><div class="clearfix"></div></div></header><div id="content" class="inner"><div id="main-col" class="alignleft"><div id="wrapper"><article class="post"><div class="post-content"><header><div class="icon"></div><time datetime="2017-02-24T16:00:00.000Z"><a href="/aqi/">2017-02-25</a></time><h1 class="title">AQI 超标提醒</h1></header><div class="entry"><blockquote><p>现在空气成为大家关注的话题了，AQI 超标能够及时提醒自己的话还是很人性化的，许多天气 app 都可以实现这功能，我懒得再装个天气 app 了，虽然自带的也有 pm2.5 的数值，桌面小插件我也不记得每天都看下它，<del>真是懒到家了</del>还是通知提醒我比较靠谱。这就是本文的由来了。</p></blockquote><a id="more"></a><p>作为没有 vps 的人，没有24小时在线的服务器定时运行脚本，所以本地 python 就不做考虑了，但是我们有谷歌XD。</p><p>那么我们需要做的就是：</p><ol><li>获取 AQI 数值的 api</li><li>制作 rss</li><li>rss 更新就提醒自己</li></ol><p>功能 2 的启发来自于 <a href="https://binux.blog/2013/03/google-apps-script/" target="_blank" rel="external">binux</a> 关于 gas 的使用，让我们可以轻松实现 rss 的制作。顺便说下大大 github 的签到和爬虫框架都非常实用，不容错过。</p><p>去 <a href="http://aqicn.org/api/" target="_blank" rel="external">http://aqicn.org/api/</a> 申请个令牌，查看 api 文档，我这里只用了一个简单的 get 命令就行了。gas 生成 rss，代码如下</p><pre><code class="javascript">function doGet(request) {
   var response = UrlFetchApp.fetch(&quot;https://api.waqi.info/feed/changzhou/?token=你的token&quot;);
   var data = JSON.parse(response.getContentText());
   var feed = &#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;&#39;+&#39;&lt;rss version=&quot;2.0&quot;&gt;&#39;
   +&#39;&lt;channel&gt;&#39;+&#39;&lt;title&gt;AQI常州超标数值&lt;/title&gt;&#39;+&#39;&lt;link&gt;http://aqicn.org/here/&lt;/link&gt;&#39;;
   Logger.log(data.data.aqi)
   if (data.data.aqi &gt; 150){
     feed += &#39;&lt;item&gt;&#39;+&#39;&lt;title&gt;&#39;+&#39;aqi &#39;+data.data.aqi+&#39;&lt;/title&gt;&#39;+&#39;&lt;link&gt;&#39;+data.data.city.url+&#39;&lt;/link&gt;&#39;+&#39;&lt;/item&gt;&#39;;
     feed += &#39;&lt;/channel&gt;&lt;/rss&gt;&#39;;
   }
   return ContentService.createTextOutput(feed).setMimeType(ContentService.MimeType.RSS);
}
</code></pre><p>这里用的是常州做的测试，AQI&gt;150 的时候 rss 才更新，可以自行调整数值。</p><h3 id="怎么提醒自己合适呢？">怎么提醒自己合适呢？</h3><p><a href="https://ifttt.com/" target="_blank" rel="external">IFTTT</a> 满足你的一切需求，短信、邮件、Telegram，我相信这些已经足够让人满意了。</p><p>2017.03.18更新：最近发现有个 <a href="http://sc.ftqq.com/3.version" target="_blank" rel="external">微信推送</a> 很实用，所以就不用生成 rss 那么麻烦了，超标以后直接微信推送提醒自己。</p><pre><code class="javascript">function doGet(request) {
   var response = UrlFetchApp.fetch(&quot;https://api.waqi.info/feed/changzhou/?token=你的token&quot;);
   var data = JSON.parse(response.getContentText());
   if (data.data.aqi &gt; 150){
     UrlFetchApp.fetch(&quot;http://sc.ftqq.com/你的另一个token.send&quot;+&quot;?text=&quot;+encodeURI(&quot;今天空气超标:&quot;)+data.data.aqi+&quot;&amp;desp=&quot;+data.data.city.url);
   }
   Logger.log(data.data.aqi);
}
</code></pre></div><footer><div class="categories"><a href="/categories/life/">life</a></div><div class="clearfix"></div></footer></div></article><nav id="pagination"><a href="/film2wunderlist/" class="alignleft prev">上一页</a> <a href="/lyric/" class="alignright next">下一页</a><div class="clearfix"></div></nav><section id="comment"><h1 class="title">留言</h1><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></div></div><aside id="sidebar" class="alignright"><div class="search"><form action="//www.google.com/search" method="get" accept-charset="utf-8"><input type="search" name="q" results="0" placeholder="搜索"> <input type="hidden" name="q" value="site:3rogue.xyz"></form></div><div class="widget tag"><h3 class="title">分类</h3><ul class="entry"><li><a href="/categories/acg/">acg</a><small>1</small></li><li><a href="/categories/blog/">blog</a><small>2</small></li><li><a href="/categories/life/">life</a><small>2</small></li><li><a href="/categories/python/">python</a><small>6</small></li><li><a href="/categories/sth/">sth</a><small>1</small></li></ul></div><div class="widget tagcloud"><h3 class="title">标签云</h3><div class="entry"><a href="/tags/Hexo/" style="font-size:10px">Hexo</a> <a href="/tags/Markdown/" style="font-size:10px">Markdown</a> <a href="/tags/Pushbullet/" style="font-size:10px">Pushbullet</a> <a href="/tags/Telegram/" style="font-size:10px">Telegram</a> <a href="/tags/acg/" style="font-size:10px">acg</a> <a href="/tags/douban/" style="font-size:10px">douban</a> <a href="/tags/https/" style="font-size:10px">https</a> <a href="/tags/image/" style="font-size:10px">image</a> <a href="/tags/杂物间/" style="font-size:10px">杂物间</a> <a href="/tags/爬虫/" style="font-size:20px">爬虫</a></div></div></aside><div class="clearfix"></div></div><footer id="footer" class="inner"><div class="alignleft">&copy; 2017 Yeoman</div><div class="clearfix"></div></footer><script src="/google-code-prettify/prettify.js"></script><script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script><script src="/js/jquery.imagesloaded.min.js"></script><script src="/js/gallery.js"></script><script>$(window).load(function(){$("pre").addClass("prettyprint linenums").attr("style","overflow:auto;"),PR.prettyPrint()})</script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script type="text/javascript">!function(n){n(".fancybox").fancybox()}(jQuery)</script></body>